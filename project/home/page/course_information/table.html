<!-- 模板引擎 table 页面 -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>样式开发测试测试测试测试单</title>
    <link rel="stylesheet" href="../../layui/css/layui.css">
    <link rel="stylesheet" href="../../css/diy.css">
  <style>
        .layui-body {
            overflow-x: scroll;
        }
        body{
      background:none;
        }
        img {
            width: 20px;
            height: 20px;
        }
    </style>
</head>

<body>
<div class="section">
    <!-- 内容主体区域 -->
    
    <div class="manu manu-btns" style="padding: 15px;">
        <form class="layui-form" action="">
            <div class="form-input-box-s layui-form-item">
                
                                                                                    <div class="layui-inline">
                            <label class="layui-form-label">课程名称</label>
                                                            <div class="layui-input-inline input-i block">
                                    <input type="text" name="title" required lay-verify="required" autocomplete="off"
                                           class="layui-input">
                                </div>
                                </div>
                                                                                                                        <div class="layui-inline">
                            <label class="layui-form-label">课程编号</label>
                                                            <div class="layui-input-inline input-i block">
                                    <input type="text" name="title" required lay-verify="required" autocomplete="off"
                                           class="layui-input">
                                </div>
                                </div>
                                                                                                                        <div class="layui-inline">
                            <label class="layui-form-label">任课教师</label>
                                                            <div class="layui-input-inline select block">
                                    <select name="teacher" lay-filter="teacher" id="teacher">
                                        <option value=""></option>
                                    </select>
                                </div>
                                </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="layui-inline">
                            <label class="layui-form-label">课程类型</label>
                                                            <div class="layui-input-inline select block">
                                                                        <select name="interest" lay-filter="course_type" id="course_type">
                                        <option value=""></option>
                                    </select>
                                                                    </div>
                            </div>

                                                                                                                                                                                            </div>
            <div class="buts  layui-form-item">
                            <button type="button" class="layui-btn" id="inquire"><span>查询</span></button>
                <button type="button" class="layui-btn" id="reset"><span>重置</span></button>
                        <button type="button" class="layui-btn" id="delete" style="display: none"><span>删除</span></button>
            <button  type="button" class="layui-btn" target="main_self_frame" id="add" style="display: none"><span>新增</span></button>

                            <div id="importDiv">
                    <input id="excel-file" type="file" style="position: absolute;
            clip: rect(0, 0, 0, 0);">
                    <label for="excel-file" class="layui-btn"><span>导入</span></label>
                </div>
                                    </div>
        </form>

          

        <div class="Customize-the-box">
            <div class="circle"></div>
            <div class="circle"></div>
            <div class="card-inner"></div>
        </div>
    </div>
  
  
 
    <p id='course_information_text' class="table_name_text">数据列表</p>
    <div class="table">
        <table class="layui-hide" id="course_information" lay-filter="course_information"></table>

        <script type="text/html" id="toolbarDemo">
            <div class="layui-btn-container">

                                                            <!--跨表按钮-->
                                                    {{# if(d.add_student_course_selection>0){ }}
                            <button class="layui-btn layui-btn-sm" lay-event="student_course_selection">选课</button>
                            {{# } }}
                                                    {{# if(d.add_course_grades>0){ }}
                            <button class="layui-btn layui-btn-sm" lay-event="course_grades">成绩</button>
                            {{# } }}
                                                            
                                                                    <button class="layui-btn layui-btn-sm" lay-event="comments">查看评论</button>
                
                {{# if(d.detail_flag){ }}
                <button class="layui-btn layui-btn-sm" lay-event="detail">详情</button>
                {{# } }}

                                <button class="layui-btn layui-btn-sm" lay-event="novel_chapters">内容设置</button>
                            </div>
        </script>
    </div>
</div>
</body>
<script src="../../js/jquery.2.1.1.min.js"></script>
<script src="../../layui/layui.js"></script>
<script src="../../js/index.js"></script>
<script src="../../js/base.js"></script>
<script src="../../js/axios.min.js"></script>
<script src="../../js/permissionSet.js"></script>
        <script src="../../js/xlsx.core.min.js" charset="utf-8"></script>
    <script>

    var BaseUrl = baseUrl()
   let tabNameText = $getUrlParams().tabName
    $('#course_information_text').text(tabNameText+'列表')
    layui.use(['element', 'layer', 'util'], function () {
        var element = layui.element
                , layer = layui.layer
                , util = layui.util
                , table = layui.table
                , $ = layui.$;

        let personInfo = JSON.parse(sessionStorage.personInfo)
        let user_group = personInfo.user_group
        let use_id = personInfo.user_id
        let url = BaseUrl + '/api/course_information/get_list?like=0'
        let add = document.querySelector('#add')
        let deletes = document.querySelector('#delete')
        
        let sqlwhere
        let data_data = {size: 10, orderby: 'create_time desc'}
        let detail_flag = false;
         add.addEventListener('click', () => {
              window.location.href = "./view.html";
        })
        // 获取路径权限
        async function get_list() {
            let {data: ren} = await axios.get(BaseUrl + '/api/auth/get_list', {
                params: {
                    user_group: personInfo.user_group
                }
            })
        }

        get_list()


        // 权限判断
        /**
         * 获取路径对应操作权限 鉴权
         * @param {String} action 操作名
         */
        function $check_action(path1, action = "get") {
            var o = $get_power(path1);
            if (o && o[action] != 0 && o[action] != false) {
                return true;
            }
            return false;
        }

        if (user_group == "管理员" || $check_action('/course_information/table', 'del') || $check_action('/course_information/view', 'del')) {
            deletes.style.display = "inline-block"
        }
        if (user_group == "管理员" || $check_action('/course_information/table', 'add') || $check_action('/course_information/view', 'add')) {
            add.style.display = "inline-block"
        }
        if (user_group == "管理员" || $check_action('/course_information/view', 'get') || $check_action('/course_information/view', 'set')) {
            detail_flag = true;
        }

        /**
         * 获取权限
         * @param {String} path 路由路径
         */
        function $get_power(path) {
            var list_data = JSON.parse(sessionStorage.list_data)
            var list = list_data;
            var obj;
            for (var i = 0; i < list.length; i++) {
                var o = list[i];
                if (o.path === path) {
                    obj = o;
                    break;
                }
            }
            return obj;
        }

        var path1

        function getpath() {
            var list_data = JSON.parse(sessionStorage.list_data)
            for (var i = 0; i < list_data.length; i++) {
                var o = list_data[i];
                if (o.path === "/course_information/table") {
                    console.log(o.path);
                    path1 = o.path
                        $get_power(o.path)
                }
            }
        }

        getpath()
        /**
         * 注册时是否有显示或操作字段的权限
         * @param {String} action 操作名
         * @param {String} field <span>查询</span>的字段
         * @param {String} path 路径
         */
        function $check_register_field(action, field, path1) {
            var o = $get_power(path1);
            var auth;
            if (o && o[action] != 0 && o[action] != false) {
                auth = o["field_" + action];
            }
            if (auth) {
                return auth.indexOf(field) !== -1;
            }
            return false;
        }

        /**
         * 是否有显示或操作字段的权限
         * @param {String} action 操作名
         * @param {String} field <span>查询</span>的字段
         */
        function $check_field(action, field, path1) {
            var o = $get_power(path1);
            var auth;
            if (o && o[action] != 0 && o[action] != false) {
                auth = o["field_" + action];
            }
            if (auth) {
                return auth.indexOf(field) !== -1;
            }
            return false;
        }

        /**
         * 是否有显示或操作支付的权限
         * @param {String} path 路径
         */
        function $check_pay(path) {
            let o = $get_power(path);
            if (o){
                let option = JSON.parse(o.option);
                if (option.pay)
                    return true
            }
            return false;
        }

        /**
         * 获取路径对应操作权限 鉴权
         * @param {String} action 操作名
         */
        function $check_exam(path1, action = "get") {
            var o = $get_power(path1);
            if (o) {
                var option = JSON.parse(o.option);
                if (option[action])
                    return true
            }
            return false;
        }

        function $check_option(path,op) {
            var o = $get_power(path);
            if (o){
                var option = JSON.parse(o.option);
                if (option[op])
                    return true
            }
            return false;
        }

                    if (user_group != "管理员") {
                                    sqlwhere = "(";
                                                                                                                                                                if (user_group == "教师用户") {
                                sqlwhere += "teacher = " + use_id + " or ";
                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (sqlwhere.length > 1) {
                        sqlwhere = sqlwhere.substr(0, sqlwhere.length - 4);
                        sqlwhere += ")";
                        data_data = {size: 10, orderby: 'create_time desc', sqlwhere: sqlwhere}
                    }else {
                        sqlwhere = null
                    }
                            }
        
        let token = sessionStorage.token || null
    table.render({
        elem: '#course_information'
        , toolbar: true
        ,id: 'course_information'
        , url: url
        , headers: {
            'x-auth-token': token,
            'Content-Type': 'application/json'
        }
        , page: {
            layout: ['limit', 'count', 'prev', 'page', 'next', 'skip']
            //,curr: 5
            , groups: 1
            , first: false
            , last: false
        }
        , cols: [[
                    {type: 'checkbox'}
                        
                                    , {
                field: 'course_name', width: 100, title: '课程名称', sort: true
                                                                                                                                                
            }
                                                , {
                field: 'course_id', width: 100, title: '课程编号', sort: true
                                                                                                                                                
            }
                                                , {
                field: 'teacher', width: 100, title: '任课教师', sort: true
                                                                                                                                                                    , templet:

                            function (d) {
                                let nickname = ""
                                let username = ""
                                $.ajax({
                                    url: BaseUrl + "/api/user/get_list",
                                    type: "get",
                                    async: false,
                                    data: {
                                        user_group: "教师用户"
                                    },
                                    success: function (data) {
                                        if (data && typeof data === 'string'){
                                            data = JSON.parse(data);
                                        }
                                        if (data.result) {
                                            for (let index = 0; index < data.result.list.length; index++) {
                                                if (d.teacher === data.result.list[index].user_id) {
                                                    nickname = data.result.list[index].nickname
                                                    username = data.result.list[index].username
                                                }
                                            }
                                        }
                                    }
                                });
                                return '<span>' + username + '-' + nickname + '</span>'
                            }
                
            }
                                                , {
                field: 'curriculum', width: 100, title: '课程', sort: true
                                    , templet: function (d) {
                        return "<div><img src=" + fullUrl(BaseUrl,d.curriculum) + "></div>"
                    }
                                                                                                                                                
            }
                                                , {
                field: 'release_time', width: 100, title: '发布时间', sort: true
                                                                    , templet: "<div>{{layui.util.toDateString(d.release_time, 'yyyy-MM-dd')}}</div>"
                                                                                                                
            }
                                                , {
                field: 'course_selection_time', width: 100, title: '选课时间', sort: true
                                                                                    , templet: "<div>{{layui.util.toDateString(d.course_selection_time, 'yyyy-MM-dd HH:mm:ss')}}</div>"
                                                                                                
            }
                                                , {
                field: 'course_quota', width: 100, title: '课程名额', sort: true
                                                                                                                                                
            }
                                                , {
                field: 'course_attachments', width: 100, title: '课程附件', sort: true
                                                                                                    , templet: function (d) {
                        return "<div><a href=" + fullUrl(BaseUrl,d.course_attachments) + " target='_blank'> 点击下载</a></div > "
                    }
                                                                                
            }
                                                , {
                field: 'course_audio', width: 100, title: '课程音频', sort: true
                                                                                                                                    , templet: function (d) {
                        return "<div><a href=" + fullUrl(BaseUrl,d.course_audio) + " target='_blank'> 点击播放</a></div > "
                    }
                                                
            }
                                                , {
                field: 'course_video', width: 100, title: '课程视频', sort: true
                                                                                                                                                    , templet: function (d) {
                        return "<div><a href=" + fullUrl(BaseUrl,d.course_video) + " target='_blank'> 点击播放</a></div > "
                    }
                                
            }
                                                , {
                field: 'course_website', width: 100, title: '课程网址', sort: true
                                                                                                                     , templet: function (d) {
                         return "<div><a href='"+d.course_website+"' target='_blank'>"+d.course_website+"</a></div >"
                     }
                                                                
            }
                                                , {
                field: 'course_type', width: 100, title: '课程类型', sort: true
                                                                                                                                                
            }
                                                , {
                field: 'course_notes', width: 100, title: '课程备注', sort: true
                                                                                                                                                
            }
                                                    
        
        
                
    ,
        {
            field: 'create_time',
                    width
        :
            100,
                    title
        :
            '新增时间',
                    sort
        :
            true,
                    templet
        :
            "<div>{{layui.util.toDateString(d.create_time, 'yyyy-MM-dd HH:mm:ss')}}</div>"
        }
    ,
        {
            field: 'update_time',
                    width
        :
            100,
                    title
        :
            '更新时间',
                    sort
        :
            true,
                    templet
        :
            "<div>{{layui.util.toDateString(d.update_time, 'yyyy-MM-dd HH:mm:ss')}}</div>"
        }
                ,
            {
                field: 'qrcode_title', title
            :
                '二维码标题', sort
            :
                true, width
            :
                100
            }
        ,
            {
                field: 'qrcode_img',
                        title
            :
                '二维码图片',
                        sort
            :
                true,
                        width
            :
                100,
                templet: "<div><img src={{fullUrl(BaseUrl,d.qrcode_img)}}></div>"
            }
                        ,
            {
                field: 'location_address', title
            :
                '当前位置', sort
            :
                true, width
            :
                100
            }
        
        
                ,
            {
                field: 'timer_title', title
            :
                '计时器标题', sort
            :
                true, width
            :
                100
            }
        ,
            {
                field: 'timing_start_time',
                        title
            :
                '计时开始时间',
                        sort
            :
                true,
                        width
            :
                100,
                        templet
            :
                "<div>{{layui.util.toDateString(d.timing_start_time, 'yyyy-MM-dd HH:mm:ss')}}</div>"
            }
        ,
            {
                field: 'timing_end_time',
                        title
            :
                '计时结束时间',
                        sort
            :
                true,
                        width
            :
                100,
                        templet
            :
                "<div>{{layui.util.toDateString(d.timing_end_time, 'yyyy-MM-dd HH:mm:ss')}}</div>"
            }
        
        
                ,
            {
                field: 'operate',
                        title
            :
                '操作',
                  fixed
            :
                'right',
                        sort
            :
                true,
                        width
            :
               300,
                        toolbar
            :
                "#toolbarDemo"
            }
            ]]

    ,
        done: function (res, curr, count) { // 表格渲染完成之后的回调
            if (res.count == null) { // 无数据时直接返回了
                return;
            }

                                                if (user_group === '管理员' || $check_field('get', 'course_name', path1)) {
                        // console.log("显示")
                    } else {
                        $("[data-field='course_name']").css('display', 'none');
                    }
                                                                if (user_group === '管理员' || $check_field('get', 'course_id', path1)) {
                        // console.log("显示")
                    } else {
                        $("[data-field='course_id']").css('display', 'none');
                    }
                                                                if (user_group === '管理员' || $check_field('get', 'teacher', path1)) {
                        // console.log("显示")
                    } else {
                        $("[data-field='teacher']").css('display', 'none');
                    }
                                                                if (user_group === '管理员' || $check_field('get', 'curriculum', path1)) {
                        // console.log("显示")
                    } else {
                        $("[data-field='curriculum']").css('display', 'none');
                    }
                                                                if (user_group === '管理员' || $check_field('get', 'release_time', path1)) {
                        // console.log("显示")
                    } else {
                        $("[data-field='release_time']").css('display', 'none');
                    }
                                                                if (user_group === '管理员' || $check_field('get', 'course_selection_time', path1)) {
                        // console.log("显示")
                    } else {
                        $("[data-field='course_selection_time']").css('display', 'none');
                    }
                                                                if (user_group === '管理员' || $check_field('get', 'course_quota', path1)) {
                        // console.log("显示")
                    } else {
                        $("[data-field='course_quota']").css('display', 'none');
                    }
                                                                if (user_group === '管理员' || $check_field('get', 'course_attachments', path1)) {
                        // console.log("显示")
                    } else {
                        $("[data-field='course_attachments']").css('display', 'none');
                    }
                                                                if (user_group === '管理员' || $check_field('get', 'course_audio', path1)) {
                        // console.log("显示")
                    } else {
                        $("[data-field='course_audio']").css('display', 'none');
                    }
                                                                if (user_group === '管理员' || $check_field('get', 'course_video', path1)) {
                        // console.log("显示")
                    } else {
                        $("[data-field='course_video']").css('display', 'none');
                    }
                                                                if (user_group === '管理员' || $check_field('get', 'course_website', path1)) {
                        // console.log("显示")
                    } else {
                        $("[data-field='course_website']").css('display', 'none');
                    }
                                                                if (user_group === '管理员' || $check_field('get', 'course_type', path1)) {
                        // console.log("显示")
                    } else {
                        $("[data-field='course_type']").css('display', 'none');
                    }
                                                                if (user_group === '管理员' || $check_field('get', 'course_notes', path1)) {
                        // console.log("显示")
                    } else {
                        $("[data-field='course_notes']").css('display', 'none');
                    }
                                                                        
                            if (user_group === '管理员' || $check_field('get', 'qrcode_title', path1)) {
                    // console.log("显示")
                } else {
                    $("[data-field='qrcode_title']").css('display', 'none');
                }
                if (user_group === '管理员' || $check_field('get', 'qrcode_img', path1)) {
                    // console.log("显示")
                } else {
                    $("[data-field='qrcode_img']").css('display', 'none');
                }
            
            
                            var timer_title = res.data[0].timer_title
                if (user_group === '管理员' || $check_field('get', 'timer_title', path1)) {
                    // console.log("显示")
                } else {
                    $("[data-field='timer_title']").css('display', 'none');
                }
            
                        // 重新渲染
        }
    ,
        page: true,
                request
    :
        {
            limitName: 'size'
        }
    ,
        response: {
            statusName: 'code', //规定返回/Back的状态码字段为code
                    statusCode
        :
            100 //规定成功的状态码为100
        }
    ,
        parseData: function (res) {

                                                <!--跨表按钮-->
                                            if (user_group == "管理员" || $check_action('/student_course_selection/table', 'add') || $check_action('/student_course_selection/view', 'add')) {
                            for (var i = 0; i < res.result.list.length; i++) {
                                res.result.list[i].add_student_course_selection = 1
                            }
                        }
                                            if (user_group == "管理员" || $check_action('/course_grades/table', 'add') || $check_action('/course_grades/view', 'add')) {
                            for (var i = 0; i < res.result.list.length; i++) {
                                res.result.list[i].add_course_grades = 1
                            }
                        }
                                                
            if (user_group == "管理员" || $check_pay('/course_information/table')) {
                for (var i = 0; i < res.result.list.length; i++) {
                    res.result.list[i].check_pay = true
                }
            }
            if (user_group == "管理员" || $check_action('/course_information/view', 'set') || $check_action('/course_information/view', 'get')) {
                for (var i = 0; i < res.result.list.length; i++) {
                    res.result.list[i].detail_flag = detail_flag
                }
            }
            return {
                "code": 100,
                "msg": "",
                "count": res.result.count,
                "data": res.result.list
            }
        }
    ,
        where: data_data
    })
        ;

        if(!$check_option('/course_information/table','import_db')){
            document.querySelector('#importDiv').style.display = "none"
        }

        table.on('tool(course_information)', function (obj) {
            var data = obj.data;
        if (obj.event === 'detail')
        {

                           window.location.href = "./view.html?" + data.course_information_id;
                  //layopen_dateil("./view.html?" + data.course_information_id)
                    }
                                            else if(obj.event == 'comments'){
                    let url_com = "?source_table=course_information&source_field=course_information_id&source_id="
                    sessionStorage.setItem('com_url', url_com)
                    window.location.href = "../comment/view_comments.html?" + data.course_information_id;
                }
                            
                                                                    else if (obj.event === 'student_course_selection'){
                        sessionStorage.setItem('data', JSON.stringify(data))
                       window.location.href = "../student_course_selection/view.html?student_course_selection_id=" + data.course_information_id+"&source_table=course_information"
                       // layopen_dateil("../student_course_selection/view.html?")
                    }
                                        else if (obj.event === 'course_grades'){
                        sessionStorage.setItem('data', JSON.stringify(data))
                       window.location.href = "../course_grades/view.html?course_grades_id=" + data.course_information_id+"&source_table=course_information"
                       // layopen_dateil("../course_grades/view.html?")
                    }
                                                

                                                else if(obj.event == 'novel_chapters'){
                window.location.href = "../novel_chapters/table.html?novel_reading_id=" + data.course_information_id;
            }
                    });

        //下拉框

        
                                                                                                                local("teacher", "教师用户", "teacher")
                let teacher
                layui.form.on('select(teacher)', function (data) {
                    request['teacher'] = Number(data.elem[data.elem.selectedIndex].value);
                });
                                                                                                                                                                                                                                                                                                                async function initss(url, id, ff) {
                    // 拿到单选框的父级节点
                    var select = document.querySelector("#"+id)
                    var op1 = document.createElement('option')
                    select.appendChild(op1)
                    // 收集数据 长度
                    var count
                    // 收集数据 数组
                    var arr = []
                    let {data: res} = await axios.get(url)
                    count = res.result.count
                    arr = res.result.list
                    for (var i = 0; i < arr.length; i++) {
                        // 创建节点
                        var op = document.createElement('option')
                        // 给节点赋值
                        op.innerHTML = arr[i][ff]
                        op.value = arr[i][ff]
                        // 新增/Add节点
                        select.appendChild(op)
                        layui.form.render('select')
                    }
                }

                initss(BaseUrl + '/api/course_classification/get_list?', "course_type", "course_type")

                let course_type
                layui.form.on('select(course_type)', function (data) {
                    request['course_type'] = data.elem[data.elem.selectedIndex].text
                });
                                                                                                                                                                                                                                                                                                                                                                                                
        // 请求参数：
        let request = {
            like: 0, size: 10, page: 1,
                                                                                    'course_name': '',
                                                                                                            'course_id': '',
                                                                                                            'teacher': '',
                                                                                                                                                                                                                                                                                                                                            'course_type': '',
                                                                                                                }

        if (user_group != "管理员") {
            request['orderby'] = 'create_time desc'
            if (sqlwhere){
                request['sqlwhere'] = sqlwhere
            }
        }

        // <span>重置</span>/Reset参数
        let resetName = data_data

        // 下拉框的<span>重置</span>/Reset参数
        let resetSelect = []
        //下拉框<span>重置</span>/Reset参数
        fun('course_information', BaseUrl + '/api/course_information/del', 'course_information_id', request, resetName, resetSelect        )


                                    let json_fields = {
                                                                        "课程名称": 'course_name',
                                                                                                "课程编号": 'course_id',
                                                                                                                                                                    "课程": 'curriculum',
                                                                                                "发布时间": 'release_time',
                                                                                                "选课时间": 'course_selection_time',
                                                                                                "课程名额": 'course_quota',
                                                                                                "课程附件": 'course_attachments',
                                                                                                "课程音频": 'course_audio',
                                                                                                "课程视频": 'course_video',
                                                                                                "课程网址": 'course_website',
                                                                                                "课程类型": 'course_type',
                                                                                                "课程备注": 'course_notes',
                                                                                                "课程详情": 'course_details',
                                                                                        "计时器标题": 'timer_title',
                        "计时开始时间": 'timing_start_time',
                        "计时结束时间": 'timing_end_time',
                                                                                    "二维码标题": 'qrcode_title',
                        "二维码图片": 'qrcode_img',
                                                        }
                
            $('#excel-file').change(function (e) {
                var files = e.target.files;

                var fileReader = new FileReader();
                fileReader.onload = function (ev) {
                    try {
                        var data = ev.target.result,
                                workbook = XLSX.read(data, {
                                    type: 'binary'
                                }), // 以二进制流方式读取得到整份excel表格对象
                                persons = []; // 存储获取到的数据
                    } catch (e) {
                        console.log('文件类型不正确');
                        return;
                    }

                    // 表格的表格范围，可用于判断表头是否数量是否正确
                    var fromTo = '';
                    // 遍历每张表读取
                    for (var sheet in workbook.Sheets) {
                        if (workbook.Sheets.hasOwnProperty(sheet)) {
                            fromTo = workbook.Sheets[sheet]['!ref'];
                            console.log(fromTo);
                            persons = persons.concat(XLSX.utils.sheet_to_json(workbook.Sheets[sheet]));
                            // break; // 如果只取第一张表，就<span>取消</span>注释这行
                        }
                    }
                        persons.forEach((item) => {
                    let form_data2 = {
                                                                                "course_name":  '', // 课程名称
                                                                                                            "course_id": $get_stamp(), // 课程编号
                                                                                                                "teacher": 0, // 任课教师
                                                                                                            "curriculum":  '', // 课程
                                                                                                            "release_time":  '', // 发布时间
                                                                                                            "course_selection_time":  '', // 选课时间
                                                                                                            "course_quota":  0, // 课程名额
                                                                                                            "course_attachments":  '', // 课程附件
                                                                                                            "course_audio":  '', // 课程音频
                                                                                                            "course_video":  '', // 课程视频
                                                                                                            "course_website":  '', // 课程网址
                                                                                                            "course_type":  '', // 课程类型
                                                                                                            "course_notes":  '', // 课程备注
                                                                                                            "course_details":  '', // 课程详情
                                                                                                                                                                                "qrcode_title": '', // 二维码标题
                            "qrcode_img": '', // 图片
                                                                                                    "timer_title": '', // 计时器标题
                            "timing_start_time": '', // 计时开始时间
                            "timing_end_time": '', // 计时结束时间
                                                                                            }
                    // 将中文的键名替换成英文的
                    for (let k in json_fields) {
                        let newKey = json_fields[k];
                        if (newKey) {
                            item[newKey] = item[k];
                            delete item[k];
                        }
                    }
                    Object.keys(item).forEach(dbKey => {
                        if (dbKey === "新增时间" || dbKey === "更新时间") {
                            delete item[dbKey]
                        }
                    })

                    Object.keys(item).forEach(key => {
                        Object.keys(form_data2).forEach(dbKey => {
                            if (key === dbKey) {
                                form_data2[dbKey] = item [key]
                            }
                            if (form_data2[dbKey] == undefined) {
                                form_data2[dbKey] = ""
                            }
                            if (dbKey == "date" || dbKey == "required_date") {
                                form_data2[dbKey] = "2022-12-19"
                            }
                        })
                    })

                    axios.post(BaseUrl + '/api/course_information/add', form_data2, {
                        headers: {
                            'x-auth-token': token,
                            'Content-Type': 'application/json'
                        }
                    }).then(async function (response) {
                        layer.msg('导入成功')
                        setTimeout(function () {
                            location.reload();
                        }, 500)
                    })
                })

                


                };

                // 以二进制方式打开文件
                fileReader.readAsBinaryString(files[0]);
            });

              
    })
</script>

</html>
